## 1. Planning
- [x] 1.1 Audit current course list/card consumers (AllCoursesPanel, CandidateExplorerPanel, SelectedCoursesPanel) and their state stores to note available fields: capacity, vacancy, status, campus/cross-campus flag source, hover handlers, and grouping logic. _(All panels render list rows with teacher/slot/location/campus/credit; grouped by name via collapse setting; hover uses `handleHover` in state; cross-campus flag currently absent—needs new indicator.)_
- [x] 1.2 Verify capacity math from data sources (courseCatalog/courseFilters): confirm vacancy/capacity values, overflow representation, and how “已选” maps to remaining seats for the ring. _(courseCatalog entries expose `capacity`/`vacancy`; overflow implied by vacancy < 0; remaining = max(vacancy, 0) for display; no explicit “selected count” separate from capacity.)_
- [x] 1.3 Capture existing hover/clip-path behavior in calendar/list views to understand what must be preserved (especially hover registration performance and clip-path shapes). _(List hover via `courseHover` store; calendar hover only for selected entries; clip-path logic in `CourseCalendarPanel.state.ts` to keep unchanged.)_
- [x] 1.4 Locate and document current color utilities (`app/src/lib/utils/color.ts`) and any existing collision-avoidance heuristics (e.g., calendar color assignments) to reuse/extend. _(Color functions `colorFromHash`/`adjustHslColor`; calendar tints parity/span; no collision avoidance yet—add in new design.)_

## 2. Design & Spec
- [x] 2.1 Finalize visual/layout decisions: four-column structure, ring placement/size, collapsed vs expanded visibility (ring hidden when collapsed), tooltip/hover response, and cross-campus indicator placement. _(Captured in spec.)_
- [x] 2.2 Define color thresholds and overflow handling rules (remaining-based ring colors; overflow shows 0 with red), plus adjacency contrast adjustment rules using `colorFromHash`/`adjustHslColor`. _(Spec updated with thresholds, remaining-only center text, overflow rules, and color contrast requirement.)_
- [x] 2.3 Specify term-based “可超额/拼手速” prompt behavior: trigger on term change, persist choice per term, expose toggle in settings; document storage key/location. _(Spec includes per-term prompt and settings.)_
- [x] 2.4 Update spec deltas to include ring rules, collapsed/expanded behavior, hover expectations, cross-campus indicator, color contrast expectations, and prompt behavior. _(Added to `specs/ui-course-cards/spec.md`.)_

## 3. Implementation Prep
- [x] 3.1 Design component contracts/props for the new card (inputs for capacity, remaining, campus flags, group collapse state, hover callbacks, color seed, and “prompt shown” state). _(Props: id/title/teacher+id/time/location/campus/crossCampusEnabled/status; capacity/vacancy → remaining; collapsed boolean; colorSeed (course.id/hash); hover handlers; variant count; overflow flag; prompt state handled at page level.)_
- [x] 3.2 Plan hover registration lifecycle for selected vs unselected items (lazy attach on expand/hover for unselected; eager for selected) and GC/cleanup strategy to avoid perf regressions. _(Selected lists keep hover always; unselected grouped variants register on expand/hover and clear on leave; clean via `clearHover` with source; avoid repeated activation via lastHover guard.)_
- [x] 3.3 Outline integration points: course list panels, calendar rendering (keep clip-path), settings UI for prompt toggle, and storage layer for term-scoped prompt acknowledgment. _(Panels: All/Candidate/Selected swap to new card; calendar keeps clip-path/colors; settings adds toggle; term-scoped storage via termId key in local storage.)_
- [x] 3.4 Enumerate validation steps: visual QA for thresholds/colors, collapsed vs expanded rendering, hover responsiveness, cross-campus indicator, overflow case, prompt trigger/persistence across term changes. _(Cases: 60/75/80/100/overflow; remaining text 0-10-5 bounds; group collapsed hides ring; hover visible; cross-campus indicator shows when enabled; prompt shows once per term and toggles via settings.)_

## 4. Validation
- [x] 4.1 Run `openspec validate redesign-course-cards --strict` and ensure deltas are consistent.
